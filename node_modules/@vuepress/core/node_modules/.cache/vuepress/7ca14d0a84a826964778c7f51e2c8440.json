{"remainingRequest":"/Users/liheng/Documents/workspace/vuepress-element-extend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liheng/Documents/workspace/vuepress-element-extend/docs/.vuepress/components/UEditor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liheng/Documents/workspace/vuepress-element-extend/docs/.vuepress/components/UEditor.vue","mtime":1598337811791},{"path":"/Users/liheng/Documents/workspace/vuepress-element-extend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liheng/Documents/workspace/vuepress-element-extend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGNoZWNrUHJvcHMgfSBmcm9tICd1dGlscycKCmNvbnN0IEVESVRPUl9TQ1JJUFRfSUQgPSAnZWRpdG9yU2NyaXB0VGFnJwpjb25zdCBFRElUT1JfQ09ORklHX0lEID0gJ2NvbmZpZ1NjcmlwdFRhZycKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVUVkaXRvcicsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHVlSWQ6IGBlZGl0b3JfJHtNYXRoLnJhbmRvbSgpCiAgICAgICAgLnRvU3RyaW5nKCkKICAgICAgICAuc3Vic3RyKDIpfWAsCiAgICAgIGlmcmFtZUlkOiBgaWZyYW1lXyR7TWF0aC5yYW5kb20oKQogICAgICAgIC50b1N0cmluZygpCiAgICAgICAgLnN1YnN0cigyKX1gLAogICAgICBpbnN0YW5jZTogbnVsbCwKICAgICAgaW5uZXJNb2RpZnk6IGZhbHNlLAogICAgICBlZGl0b3JSZWFkeTogZmFsc2UsCiAgICAgIGlzRm9jdXM6IGZhbHNlLAogICAgICBzcmM6ICcnLAogICAgICBiYXNlQ29uZmlnOiB7CiAgICAgICAgVUVESVRPUl9IT01FX1VSTDogJy91ZS8nLAogICAgICAgIHNlcnZlclVybDogJy91ZS9qc3AvY29uZmlnLmpzb24nLAogICAgICAgIGluaXRpYWxGcmFtZVdpZHRoOiAnMTAwJScKICAgICAgfQogICAgfQogIH0sCiAgcHJvcHM6IHsKICAgIHBhdGg6IGNoZWNrUHJvcHMuc3RyRGVmKCcvdWUvJyksCiAgICBjb25maWc6IGNoZWNrUHJvcHMub2JqRGVmKHt9KSwKICAgIHZhbHVlOiBjaGVja1Byb3BzLnN0ckRlZignJyksCiAgICBkaXNhYmxlZDogY2hlY2tQcm9wcy5ib29sRGVmKGZhbHNlKSwKICAgIGhlaWdodDogY2hlY2tQcm9wcy5zdHJEZWYoJ2F1dG8nKQogIH0sCiAgd2F0Y2g6IHsKICAgIHZhbHVlKHZhbCkgewogICAgICBpZiAodGhpcy5kaXNhYmxlZCkgewogICAgICAgIC8vIOWwhiBlZGl0b3Ig5Lit55qE5YaF5a655L+d5a2Y5YiwIHNlc3Npb25TdG9yYWdlCiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSh0aGlzLmlmcmFtZUlkLCB2YWwpCiAgICAgICAgdGhpcy5zcmMgPSBgL3VlZGl0b3IuaHRtbD9pZD0ke3RoaXMuaWZyYW1lSWR9Jl90PSR7RGF0ZS5ub3coKX1gCiAgICAgICAgdGhpcy5yZXNpemVIZWlnaHQoKQogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIGlmICh0aGlzLmlubmVyTW9kaWZ5KSB7CiAgICAgICAgdGhpcy5pbm5lck1vZGlmeSA9IGZhbHNlCiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJNb2RpZnkKICAgICAgfQogICAgICB0aGlzLnNldENvbnRlbnQodmFsKQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgc2V0RW5hYmxlZCgpIHsKICAgICAgdGhpcy5pbnN0YW5jZSAmJiB0aGlzLmluc3RhbmNlLnNldEVuYWJsZWQoKQogICAgfSwKICAgIHNldEhpZGUoKSB7CiAgICAgIHRoaXMuaW5zdGFuY2UgJiYgdGhpcy5pbnN0YW5jZS5zZXRIaWRlKCkKICAgIH0sCiAgICBjbGVhckRvYygpIHsKICAgICAgdGhpcy5pbnN0YW5jZSAmJiB0aGlzLmluc3RhbmNlLmV4ZWNDb21tYW5kKCdjbGVhcmRvYycpCiAgICB9LAogICAgZ2V0Q29udGVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2UgJiYgdGhpcy5pbnN0YW5jZS5nZXRDb250ZW50KCkKICAgIH0sCiAgICBzZXRDb250ZW50KGh0bWwpIHsKICAgICAgdGhpcy5lZGl0b3JSZWFkeQogICAgICAgID8gdGhpcy5pbnN0YW5jZS5zZXRDb250ZW50KGh0bWwpCiAgICAgICAgOiBzZXRUaW1lb3V0KCgpID0+IHRoaXMuc2V0Q29udGVudChodG1sKSwgMTAwKQogICAgfSwKICAgIGluaXRFZGl0b3IoKSB7CiAgICAgIGlmICghd2luZG93LlVFIHx8IHRoaXMuaW5zdGFuY2UpIHJldHVybgogICAgICBsZXQgaW50ZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgaWYgKHdpbmRvdy5VRS5nZXRFZGl0b3IpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXIpCiAgICAgICAgICB0aGlzLmluc3RhbmNlID0gd2luZG93LlVFLmdldEVkaXRvcih0aGlzLnVlSWQsIHsgLi4udGhpcy5iYXNlQ29uZmlnLCAuLi50aGlzLmNvbmZpZyB9KQogICAgICAgICAgLy8gaHR0cDovL2ZleC5iYWlkdS5jb20vdWVkaXRvci8jcWEtcmVhZHkKICAgICAgICAgIC8vIHRoaXMuaW5zdGFuY2UuYWRkTGlzdGVuZXIoJ3JlYWR5JywgdGhpcy5kb1JlYWR5KQogICAgICAgICAgdGhpcy5pbnN0YW5jZS5yZWFkeSh0aGlzLmRvUmVhZHkpCiAgICAgICAgICB0aGlzLmluc3RhbmNlLmFkZExpc3RlbmVyKCdjb250ZW50Q2hhbmdlJywgdGhpcy5jb250ZW50Q2hhbmdlKQogICAgICAgICAgdGhpcy5pbnN0YW5jZS5hZGRMaXN0ZW5lcignYmx1cicsIHRoaXMuYmx1cikKICAgICAgICAgIHRoaXMuaW5zdGFuY2UuYWRkTGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5mb2N1cykKICAgICAgICB9CiAgICAgIH0sIDMwKQogICAgfSwKICAgIGJsdXIoKSB7CiAgICAgIHRoaXMuY29udGVudENoYW5nZSgpCiAgICAgIHRoaXMuaXNGb2N1cyA9IGZhbHNlCiAgICB9LAogICAgZm9jdXMoKSB7CiAgICAgIHRoaXMuaXNGb2N1cyA9IHRydWUKICAgIH0sCiAgICBkb1JlYWR5KCkgewogICAgICB0aGlzLiRlbWl0KCdyZWFkeScsIHRoaXMuaW5zdGFuY2UpCiAgICAgIHRoaXMuZWRpdG9yUmVhZHkgPSB0cnVlCiAgICAgIC8vIOiuvue9rue8lui+keWZqOWGheWuueWMuumrmOW6pu+8jOS9huS8muWHuueOsOa7muWKqOadoQogICAgICAvLyB0aGlzLmluc3RhbmNlLnNldEhlaWdodCh0aGlzLmhlaWdodCA9PT0gJ2F1dG8nID8gMTAwIDogdGhpcy5oZWlnaHQpCiAgICAgIHRoaXMuaW5zdGFuY2Uuc2V0Q29udGVudCh0aGlzLnZhbHVlKQogICAgfSwKICAgIGNvbnRlbnRDaGFuZ2UoKSB7CiAgICAgIGNvbnN0IHZhbCA9IHRoaXMuZ2V0Q29udGVudCgpCiAgICAgIGlmICh0aGlzLmlzRm9jdXMpIHsKICAgICAgICB0aGlzLmlubmVyTW9kaWZ5ID0gdHJ1ZQogICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgdmFsKQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5pbm5lck1vZGlmeSA9IGZhbHNlCiAgICAgICAgfSkKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGluc2VydFNjcmlwdCgpIHsKICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWwogICAgICAgIHRoaXMuaW5zZXJ0KEVESVRPUl9TQ1JJUFRfSUQsICd1ZWRpdG9yLmFsbC5taW4uanMnKSwKICAgICAgICB0aGlzLmluc2VydChFRElUT1JfQ09ORklHX0lELCAndWVkaXRvci5jb25maWcuanMnKQogICAgICBdKS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLmluaXRFZGl0b3IoKQogICAgICB9KQogICAgfSwKICAgIGFzeW5jIGluc2VydChpZCwgZmlsZU5hbWUpIHsKICAgICAgbGV0IHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkKICAgICAgaWYgKHMpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkKICAgICAgfQogICAgICBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykKICAgICAgcy5zcmMgPSB0aGlzLnBhdGggKyBmaWxlTmFtZQogICAgICBzLmlkID0gaWQKICAgICAgY29uc3QgaGVhZCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXQogICAgICBoZWFkLmFwcGVuZENoaWxkKHMpCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHMuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHJlc29sdmUoKSkpCiAgICB9LAogICAgcmVzaXplSGVpZ2h0KCkgewogICAgICBpZiAodGhpcy5oZWlnaHQgPT09ICdhdXRvJykgewogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIGxldCBpZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmlmcmFtZUlkKQogICAgICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzBweCcpCiAgICAgICAgICAvLyBpZnJhbWUuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nCiAgICAgICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKAogICAgICAgICAgICAgICdoZWlnaHQnLAogICAgICAgICAgICAgIHRoaXMuY29udGVudFdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0ICsgJ3B4JwogICAgICAgICAgICApCiAgICAgICAgICAgIC8vIHRoaXMuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0KICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICBpZiAodGhpcy5kaXNhYmxlZCkgewogICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHRoaXMuaWZyYW1lSWQsIHRoaXMudmFsdWUpCiAgICAgIHRoaXMuc3JjID0gYC91ZWRpdG9yLmh0bWw/aWQ9JHt0aGlzLmlmcmFtZUlkfSZfdD0ke0RhdGUubm93KCl9YAogICAgICAvLyDlpoLmnpwgaWZyYW1lIOeItuWFg+e0oOacquiuvue9rumrmOW6pu+8jOiuqSBpZnJhbWUg5pKR5byACiAgICAgIHRoaXMucmVzaXplSGVpZ2h0KCkKICAgIH0gZWxzZSB7CiAgICAgIGlmICh3aW5kb3cuVUUpIHsKICAgICAgICB0aGlzLmluaXRFZGl0b3IoKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW5zZXJ0U2NyaXB0KCkKICAgICAgfQogICAgfQogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5pZnJhbWVJZCkKICAgIGlmICh0aGlzLmluc3RhbmNlKSB7CiAgICAgIHRoaXMuaW5zdGFuY2UucmVtb3ZlTGlzdGVuZXIoJ3JlYWR5JywgdGhpcy5kb1JlYWR5KQogICAgICB0aGlzLmluc3RhbmNlLnJlbW92ZUxpc3RlbmVyKCdjb250ZW50Q2hhbmdlJywgdGhpcy5jb250ZW50Q2hhbmdlKQogICAgICB0aGlzLmluc3RhbmNlLnJlbW92ZUxpc3RlbmVyKCdibHVyJywgdGhpcy5ibHVyKQogICAgICB0aGlzLmluc3RhbmNlLnJlbW92ZUxpc3RlbmVyKCdmb2N1cycsIHRoaXMuZm9jdXMpCiAgICAgIHRoaXMuaW5zdGFuY2UuZGVzdHJveSgpCiAgICAgIHRoaXMuaW5zdGFuY2UgPSBudWxsCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["UEditor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAgBA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UEditor.vue","sourceRoot":"docs/.vuepress/components","sourcesContent":["<template>\n  <div class=\"u-editor\" :style=\"{ height }\">\n    <!-- 利用 iframe 可以使 reset.css 不起作用；动态 src 是为了重新加载 html 页面，避免缓存 -->\n    <iframe\n      :id=\"iframeId\"\n      v-if=\"disabled\"\n      :src=\"src\"\n      width=\"100%\"\n      height=\"100%\"\n      frameborder=\"0\"\n    ></iframe>\n    <script v-else :id=\"ueId\" type=\"text/plain\" name=\"content\" />\n  </div>\n</template>\n\n<script>\nimport { checkProps } from 'utils'\n\nconst EDITOR_SCRIPT_ID = 'editorScriptTag'\nconst EDITOR_CONFIG_ID = 'configScriptTag'\n\nexport default {\n  name: 'UEditor',\n  data() {\n    return {\n      ueId: `editor_${Math.random()\n        .toString()\n        .substr(2)}`,\n      iframeId: `iframe_${Math.random()\n        .toString()\n        .substr(2)}`,\n      instance: null,\n      innerModify: false,\n      editorReady: false,\n      isFocus: false,\n      src: '',\n      baseConfig: {\n        UEDITOR_HOME_URL: '/ue/',\n        serverUrl: '/ue/jsp/config.json',\n        initialFrameWidth: '100%'\n      }\n    }\n  },\n  props: {\n    path: checkProps.strDef('/ue/'),\n    config: checkProps.objDef({}),\n    value: checkProps.strDef(''),\n    disabled: checkProps.boolDef(false),\n    height: checkProps.strDef('auto')\n  },\n  watch: {\n    value(val) {\n      if (this.disabled) {\n        // 将 editor 中的内容保存到 sessionStorage\n        sessionStorage.setItem(this.iframeId, val)\n        this.src = `/ueditor.html?id=${this.iframeId}&_t=${Date.now()}`\n        this.resizeHeight()\n        return\n      }\n      if (this.innerModify) {\n        this.innerModify = false\n        return this.innerModify\n      }\n      this.setContent(val)\n    }\n  },\n  methods: {\n    setEnabled() {\n      this.instance && this.instance.setEnabled()\n    },\n    setHide() {\n      this.instance && this.instance.setHide()\n    },\n    clearDoc() {\n      this.instance && this.instance.execCommand('cleardoc')\n    },\n    getContent() {\n      return this.instance && this.instance.getContent()\n    },\n    setContent(html) {\n      this.editorReady\n        ? this.instance.setContent(html)\n        : setTimeout(() => this.setContent(html), 100)\n    },\n    initEditor() {\n      if (!window.UE || this.instance) return\n      let inter = setInterval(() => {\n        if (window.UE.getEditor) {\n          clearInterval(inter)\n          this.instance = window.UE.getEditor(this.ueId, { ...this.baseConfig, ...this.config })\n          // http://fex.baidu.com/ueditor/#qa-ready\n          // this.instance.addListener('ready', this.doReady)\n          this.instance.ready(this.doReady)\n          this.instance.addListener('contentChange', this.contentChange)\n          this.instance.addListener('blur', this.blur)\n          this.instance.addListener('focus', this.focus)\n        }\n      }, 30)\n    },\n    blur() {\n      this.contentChange()\n      this.isFocus = false\n    },\n    focus() {\n      this.isFocus = true\n    },\n    doReady() {\n      this.$emit('ready', this.instance)\n      this.editorReady = true\n      // 设置编辑器内容区高度，但会出现滚动条\n      // this.instance.setHeight(this.height === 'auto' ? 100 : this.height)\n      this.instance.setContent(this.value)\n    },\n    contentChange() {\n      const val = this.getContent()\n      if (this.isFocus) {\n        this.innerModify = true\n        this.$emit('input', val)\n        setTimeout(() => {\n          this.innerModify = false\n        })\n      }\n    },\n    async insertScript() {\n      await Promise.all([\n        this.insert(EDITOR_SCRIPT_ID, 'ueditor.all.min.js'),\n        this.insert(EDITOR_CONFIG_ID, 'ueditor.config.js')\n      ]).then(() => {\n        this.initEditor()\n      })\n    },\n    async insert(id, fileName) {\n      let s = document.getElementById(id)\n      if (s) {\n        return Promise.resolve()\n      }\n      s = document.createElement('script')\n      s.src = this.path + fileName\n      s.id = id\n      const head = document.head || document.getElementsByTagName('head')[0]\n      head.appendChild(s)\n      return new Promise(resolve => s.addEventListener('load', () => resolve()))\n    },\n    resizeHeight() {\n      if (this.height === 'auto') {\n        this.$nextTick(() => {\n          let iframe = document.getElementById(this.iframeId)\n          iframe.setAttribute('height', '0px')\n          // iframe.style.visibility = 'hidden'\n          iframe.onload = function() {\n            this.setAttribute(\n              'height',\n              this.contentWindow.document.documentElement.scrollHeight + 'px'\n            )\n            // this.style.visibility = 'visible'\n          }\n        })\n      }\n    }\n  },\n  created() {\n    if (this.disabled) {\n      sessionStorage.setItem(this.iframeId, this.value)\n      this.src = `/ueditor.html?id=${this.iframeId}&_t=${Date.now()}`\n      // 如果 iframe 父元素未设置高度，让 iframe 撑开\n      this.resizeHeight()\n    } else {\n      if (window.UE) {\n        this.initEditor()\n      } else {\n        this.insertScript()\n      }\n    }\n  },\n  beforeDestroy() {\n    sessionStorage.removeItem(this.iframeId)\n    if (this.instance) {\n      this.instance.removeListener('ready', this.doReady)\n      this.instance.removeListener('contentChange', this.contentChange)\n      this.instance.removeListener('blur', this.blur)\n      this.instance.removeListener('focus', this.focus)\n      this.instance.destroy()\n      this.instance = null\n    }\n  }\n}\n</script>\n\n<style lang=\"less\">\n.u-editor {\n  background: #fff;\n  .edui-editor {\n    min-height: 300px;\n  }\n\n  .edui-editor-toolbarboxouter {\n    line-height: 1.42857143;\n  }\n\n  // 去掉本地保存成功提示\n  .edui-default .edui-editor-messageholder {\n    display: none;\n  }\n}\n</style>\n"]}]}